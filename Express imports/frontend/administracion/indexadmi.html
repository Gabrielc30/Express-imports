<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel de Administraci√≥n - Express Imports</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        .custom-blue { background-color: #1e40af; }
        .custom-blue-text { color: #1e40af; }
        .btn-primary { background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%); }
        .btn-primary:hover { transform: translateY(-2px); }
        .card-hover { transition: all 0.3s ease; }
        .card-hover:hover { transform: translateY(-4px); box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25); }
        .metric-card { transition: all 0.3s ease; }
        .metric-card:hover { box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04); }
        .sidebar-item { transition: all 0.3s ease; }
        .sidebar-item:hover { background-color: rgba(255, 255, 255, 0.1); }
        .sidebar-item.active { background-color: rgba(255, 255, 255, 0.15); border-right: 4px solid #fbbf24; }
        .status-badge { padding: 0.25rem 0.75rem; border-radius: 9999px; font-size: 0.75rem; font-weight: 500; }
        .table-row { transition: all 0.3s ease; }
        .table-row:hover { background-color: #f8fafc; }
        .mobile-menu { transform: translateX(-100%); transition: transform 0.3s ease; }
        .mobile-menu.active { transform: translateX(0); }
        .overlay { background-color: rgba(0, 0, 0, 0.5); }
        @media (max-width: 1024px) {
            .mobile-menu { position: fixed; z-index: 50; }
        }
        .loading { opacity: 0.5; pointer-events: none; }
        .success-message { 
            position: fixed; 
            top: 1rem; 
            right: 1rem; 
            background: #10b981; 
            color: white; 
            padding: 1rem 1.5rem; 
            border-radius: 0.5rem; 
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); 
            z-index: 1000;
            animation: slideIn 0.3s ease;
        }
        .error-message { 
            position: fixed; 
            top: 1rem; 
            right: 1rem; 
            background: #ef4444; 
            color: white; 
            padding: 1rem 1.5rem; 
            border-radius: 0.5rem; 
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); 
            z-index: 1000;
            animation: slideIn 0.3s ease;
        }
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
    </style>
</head>
<body class="bg-gray-50">
    <div id="mobile-overlay" class="fixed inset-0 overlay z-40 hidden lg:hidden"></div>
    
    <div id="sidebar" class="mobile-menu fixed left-0 top-0 h-full w-64 custom-blue text-white z-50 lg:translate-x-0">
        <div class="p-6 border-b border-white/10">
            <div class="flex items-center space-x-3">
                <div class="text-2xl font-bold">Express Imports</div>
            </div>
            <div class="text-sm opacity-75 mt-1">Panel de Administraci√≥n</div>
        </div>
        
        <nav class="mt-6">
            <div class="px-6 mb-4">
                <div class="text-xs uppercase tracking-wider opacity-60 font-semibold">MEN√ö PRINCIPAL</div>
            </div>
            
            <a href="#" onclick="showSection('dashboard')" class="sidebar-item active flex items-center px-6 py-3 text-white">
                <span class="text-xl mr-3">üìä</span>
                <span class="font-medium">Dashboard</span>
            </a>
            
            <a href="#" onclick="showSection('productos')" class="sidebar-item flex items-center px-6 py-3 text-white">
                <span class="text-xl mr-3">üì¶</span>
                <span class="font-medium">Productos</span>
            </a>
            
            <a href="#" onclick="showSection('pedidos')" class="sidebar-item flex items-center px-6 py-3 text-white">
                <span class="text-xl mr-3">üìã</span>
                <span class="font-medium">Pedidos</span>
            </a>
            
            <a href="#" onclick="showSection('configuracion')" class="sidebar-item flex items-center px-6 py-3 text-white">
                <span class="text-xl mr-3">‚öôÔ∏è</span>
                <span class="font-medium">Configuraci√≥n</span>
            </a>
            
            <div class="px-6 mt-8 mb-4">
                <div class="text-xs uppercase tracking-wider opacity-60 font-semibold">ACCIONES R√ÅPIDAS</div>
            </div>
            
            <a href="#" onclick="showAddProductModal()" class="sidebar-item flex items-center px-6 py-3 text-white">
                <span class="text-xl mr-3">‚ûï</span>
                <span class="font-medium">Agregar Producto</span>
            </a>
            
            <a href="#" class="sidebar-item flex items-center px-6 py-3 text-white">
                <span class="text-xl mr-3">üìà</span>
                <span class="font-medium">Reportes</span>
            </a>
        </nav>
        
        <div class="absolute bottom-0 left-0 right-0 p-6 border-t border-white/10">
            <div class="flex items-center space-x-3">
                <div class="w-10 h-10 bg-yellow-400 rounded-full flex items-center justify-center text-gray-900 font-bold">
                    A
                </div>
                <div>
                    <div class="font-semibold">Admin</div>
                    <div class="text-xs opacity-75">Administrador</div>
                </div>
            </div>
        </div>
    </div>

    <div class="lg:ml-64">
        <header class="bg-white shadow-sm border-b border-gray-200 sticky top-0 z-30">
            <div class="px-4 sm:px-6 lg:px-8 py-4">
                <div class="flex justify-between items-center">
                    <div class="flex items-center space-x-4">
                        <button id="mobile-menu-btn" class="lg:hidden text-gray-600 hover:text-gray-900">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                            </svg>
                        </button>
                        <div>
                            <h1 id="page-title" class="text-2xl font-bold custom-blue-text">Dashboard</h1>
                            <p id="page-subtitle" class="text-sm text-gray-600">Resumen general de tu negocio</p>
                        </div>
                    </div>
                    
                    <div class="flex items-center space-x-4">
                        <div id="connection-status" class="hidden md:flex items-center space-x-2 bg-gray-50 text-gray-700 px-3 py-2 rounded-lg">
                            <span class="w-2 h-2 bg-gray-500 rounded-full"></span>
                            <span class="text-sm font-medium">Conectando...</span>
                        </div>
                        
                        <button class="relative p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg">
                            <span class="text-xl">üîî</span>
                            <span class="absolute top-1 right-1 w-2 h-2 bg-red-500 rounded-full"></span>
                        </button>
                        
                        <a href="../index.html" class="btn-primary text-gray-900 px-4 py-2 rounded-lg font-semibold hover:shadow-lg transition-all">Ver Tienda</a>
                    </div>
                </div>
            </div>
        </header>

        <!-- Dashboard Section -->
        <div id="dashboard-section" class="p-4 sm:p-6 lg:p-8">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <div class="metric-card card-hover bg-white rounded-2xl p-6 shadow-lg border border-gray-100">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm font-medium text-gray-600">Total Productos</p>
                            <p id="total-products" class="text-3xl font-bold custom-blue-text">...</p>
                            <p class="text-sm text-green-600 font-medium">+12 este mes</p>
                        </div>
                        <div class="text-4xl">üì¶</div>
                    </div>
                </div>
                
                <div class="metric-card card-hover bg-white rounded-2xl p-6 shadow-lg border border-gray-100">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm font-medium text-gray-600">En Stock</p>
                            <p id="products-in-stock" class="text-3xl font-bold custom-blue-text">...</p>
                            <p class="text-sm text-green-600 font-medium">Disponibles</p>
                        </div>
                        <div class="text-4xl">‚úÖ</div>
                    </div>
                </div>
                
                <div class="metric-card card-hover bg-white rounded-2xl p-6 shadow-lg border border-gray-100">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm font-medium text-gray-600">Cotizaciones</p>
                            <p id="total-quotes" class="text-3xl font-bold custom-blue-text">...</p>
                            <p class="text-sm text-yellow-600 font-medium">Pendientes</p>
                        </div>
                        <div class="text-4xl">üìã</div>
                    </div>
                </div>
                
                <div class="metric-card card-hover bg-white rounded-2xl p-6 shadow-lg border border-gray-100">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm font-medium text-gray-600">√ìrdenes Stock</p>
                            <p id="total-orders" class="text-3xl font-bold custom-blue-text">...</p>
                            <p class="text-sm text-blue-600 font-medium">Total</p>
                        </div>
                        <div class="text-4xl">üõí</div>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <div class="bg-white rounded-2xl shadow-lg border border-gray-100 p-6">
                    <h3 class="text-lg font-bold custom-blue-text mb-4">Productos Recientes</h3>
                    <div id="recent-products" class="space-y-4">
                        <div class="text-center text-gray-500">Cargando...</div>
                    </div>
                </div>
                
                <div class="bg-white rounded-2xl shadow-lg border border-gray-100 p-6">
                    <h3 class="text-lg font-bold custom-blue-text mb-4">Actividad Reciente</h3>
                    <div id="recent-activity" class="space-y-4">
                        <div class="text-center text-gray-500">Cargando...</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Productos Section -->
        <div id="productos-section" class="p-4 sm:p-6 lg:p-8 hidden">
            <div class="bg-white rounded-2xl shadow-lg border border-gray-100 p-6 mb-8">
                <h3 class="text-lg font-bold custom-blue-text mb-6">Agregar Nuevo Producto</h3>
                
                <form id="product-form" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Nombre del Producto</label>
                        <input type="text" name="name" required class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Ej: iPhone 15 Pro Max">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Precio</label>
                        <input type="number" name="price" required step="0.01" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="0.00">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Categor√≠a</label>
                        <select name="category" required class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <option value="">Seleccionar categor√≠a</option>
                            <option value="electronicos">Electr√≥nicos</option>
                            <option value="hogar">Hogar</option>
                            <option value="deportes">Deportes</option>
                            <option value="moda">Moda</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Emoji</label>
                        <input type="text" name="image_emoji" maxlength="10" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="üì±">
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Cantidad en Stock</label>
                        <input type="number" name="stock_quantity" min="0" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="0">
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Estado</label>
                        <div class="flex items-center space-x-4">
                            <label class="flex items-center">
                                <input type="checkbox" name="in_stock" class="mr-2">
                                En Stock
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" name="is_offer" class="mr-2">
                                En Oferta
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" name="is_new" class="mr-2">
                                Nuevo
                            </label>
                        </div>
                    </div>
                    
                    <div class="md:col-span-2">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Descripci√≥n</label>
                        <textarea name="description" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent" rows="3" placeholder="Descripci√≥n detallada del producto"></textarea>
                    </div>
                    
                    <div class="md:col-span-2 flex gap-4">
                        <button type="submit" class="btn-primary text-gray-900 px-6 py-3 rounded-xl font-semibold hover:shadow-lg transition-all">
                            ‚ûï Agregar Producto
                        </button>
                        <button type="button" onclick="document.getElementById('product-form').reset()" class="border-2 border-gray-300 text-gray-700 px-6 py-3 rounded-xl font-semibold hover:border-gray-400 transition-all">
                            Limpiar
                        </button>
                    </div>
                </form>
            </div>

            <div class="bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden">
                <div class="p-6 border-b border-gray-200">
                    <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
                        <h3 class="text-lg font-bold custom-blue-text">Productos Existentes</h3>
                        <div class="flex gap-2">
                            <input type="text" id="search-products" placeholder="Buscar productos..." class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <button onclick="loadProducts()" class="bg-gray-100 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-200 transition-all">
                                üîç
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Producto</th>
                                <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Precio</th>
                                <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Stock</th>
                                <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Categor√≠a</th>
                                <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="products-table-body" class="bg-white divide-y divide-gray-200">
                            <tr>
                                <td colspan="5" class="px-6 py-8 text-center text-gray-500">Cargando productos...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Pedidos Section -->
        <div id="pedidos-section" class="p-4 sm:p-6 lg:p-8 hidden">
            <div class="bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden">
                <div class="p-6 border-b border-gray-200">
                    <h3 class="text-lg font-bold custom-blue-text mb-4">√ìrdenes de Stock</h3>
                </div>
                
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ID</th>
                                <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Cliente</th>
                                <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Total</th>
                                <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Estado</th>
                                <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Fecha</th>
                            </tr>
                        </thead>
                        <tbody id="orders-table-body" class="bg-white divide-y divide-gray-200">
                            <tr>
                                <td colspan="5" class="px-6 py-8 text-center text-gray-500">Cargando √≥rdenes...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden mt-8">
                <div class="p-6 border-b border-gray-200">
                    <h3 class="text-lg font-bold custom-blue-text mb-4">Cotizaciones</h3>
                </div>
                
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ID</th>
                                <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Cliente</th>
                                <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Email</th>
                                <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Estado</th>
                                <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Fecha</th>
                            </tr>
                        </thead>
                        <tbody id="quotes-table-body" class="bg-white divide-y divide-gray-200">
                            <tr>
                                <td colspan="5" class="px-6 py-8 text-center text-gray-500">Cargando cotizaciones...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Configuracion Section -->
        <div id="configuracion-section" class="p-4 sm:p-6 lg:p-8 hidden">
            <div class="bg-white rounded-2xl shadow-lg border border-gray-100 p-6">
                <h3 class="text-lg font-bold custom-blue-text mb-6">Configuraci√≥n de la API</h3>
                
                <div class="space-y-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">URL del Backend</label>
                        <input type="url" id="api-url" value="http://192.168.1.8:3000" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        <p class="text-xs text-gray-500 mt-1">Cambia esto por la IP de tu servidor backend</p>
                    </div>
                    
                    <button onclick="testConnection()" class="btn-primary text-gray-900 px-6 py-3 rounded-xl font-semibold hover:shadow-lg transition-all">
                        Probar Conexi√≥n
                    </button>

                    <div class="mt-8 p-4 bg-gray-50 rounded-lg">
                        <h4 class="font-semibold mb-2">Estado de la Conexi√≥n:</h4>
                        <div id="connection-info" class="text-sm text-gray-600">
                            Haz clic en "Probar Conexi√≥n" para verificar
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
      // Configuration
        let API_BASE_URL = localStorage.getItem('api_url') || 'http://192.168.1.8:3000';
        
        // Update API URL from input
        document.getElementById('api-url').addEventListener('input', (e) => {
            API_BASE_URL = e.target.value;
            localStorage.setItem('api_url', API_BASE_URL);
        });

        // Set initial API URL in input
        document.getElementById('api-url').value = API_BASE_URL;

        // Utility functions
        function showMessage(message, isError = false) {
            const div = document.createElement('div');
            div.className = isError ? 'error-message' : 'success-message';
            div.textContent = message;
            document.body.appendChild(div);
            
            setTimeout(() => {
                div.remove();
            }, 4000);
        }

        function updateConnectionStatus(isConnected) {
            const status = document.getElementById('connection-status');
            const dot = status.querySelector('span:first-child');
            const text = status.querySelector('span:last-child');
            
            if (isConnected) {
                dot.className = 'w-2 h-2 bg-green-500 rounded-full';
                text.textContent = 'Conectado';
            } else {
                dot.className = 'w-2 h-2 bg-red-500 rounded-full';
                text.textContent = 'Desconectado';
            }
        }

        async function apiRequest(endpoint, options = {}) {
            try {
                const response = await fetch(`${API_BASE_URL}${endpoint}`, {
                    headers: {
                        'Content-Type': 'application/json',
                        ...options.headers
                    },
                    ...options
                });
                
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error || `HTTP ${response.status}: ${response.statusText}`);
                }
                
                return await response.json();
            } catch (error) {
                console.error('API Request failed:', error);
                updateConnectionStatus(false);
                throw error;
            }
        }

        // Test connection
        async function testConnection() {
            const infoDiv = document.getElementById('connection-info');
            infoDiv.textContent = 'Probando conexi√≥n...';
            
            try {
                const response = await apiRequest('/api/test');
                updateConnectionStatus(true);
                infoDiv.innerHTML = `
                    <div class="text-green-600 font-semibold">‚úÖ Conexi√≥n exitosa</div>
                    <div class="text-sm text-gray-600 mt-1">
                        Servidor: ${response.server || 'Express Imports API'}<br>
                        Timestamp: ${new Date(response.timestamp).toLocaleString()}
                    </div>
                `;
                showMessage('Conexi√≥n establecida correctamente');
            } catch (error) {
                updateConnectionStatus(false);
                infoDiv.innerHTML = `
                    <div class="text-red-600 font-semibold">‚ùå Error de conexi√≥n</div>
                    <div class="text-sm text-gray-600 mt-1">
                        ${error.message}<br>
                        Verifica que el servidor est√© ejecut√°ndose en: ${API_BASE_URL}
                    </div>
                `;
                showMessage('Error de conexi√≥n: ' + error.message, true);
            }
        }

        // Section management
        function showSection(sectionId) {
            const sections = document.querySelectorAll('div[id$="-section"]');
            sections.forEach(sec => sec.classList.add('hidden'));
            document.getElementById(sectionId + '-section').classList.remove('hidden');

            const navItems = document.querySelectorAll('.sidebar-item');
            navItems.forEach(item => item.classList.remove('active'));
            document.querySelector(`[onclick="showSection('${sectionId}')"]`).classList.add('active');

            const pageTitle = document.getElementById('page-title');
            const pageSubtitle = document.getElementById('page-subtitle');
            
            switch (sectionId) {
                case 'dashboard':
                    pageTitle.textContent = 'Dashboard';
                    pageSubtitle.textContent = 'Resumen general de tu negocio';
                    loadDashboard();
                    break;
                case 'productos':
                    pageTitle.textContent = 'Productos';
                    pageSubtitle.textContent = 'Gesti√≥n de productos';
                    loadProducts();
                    break;
                case 'pedidos':
                    pageTitle.textContent = 'Pedidos';
                    pageSubtitle.textContent = 'Gesti√≥n de √≥rdenes y cotizaciones';
                    loadOrdersAndQuotes();
                    break;
                case 'configuracion':
                    pageTitle.textContent = 'Configuraci√≥n';
                    pageSubtitle.textContent = 'Configuraci√≥n del panel de administraci√≥n';
                    break;
            }
        }

        // Dashboard
        async function loadDashboard() {
            try {
                const products = await apiRequest('/api/products');
                const quotes = await apiRequest('/api/quotes');
                const orders = await apiRequest('/api/stock-orders');
                
                document.getElementById('total-products').textContent = products.length;
                document.getElementById('products-in-stock').textContent = products.filter(p => p.in_stock).length;
                document.getElementById('total-quotes').textContent = quotes.filter(q => q.status === 'pending').length;
                document.getElementById('total-orders').textContent = orders.length;
                
                const recentProducts = products.slice(0, 3);
                document.getElementById('recent-products').innerHTML = recentProducts.map(product => `
                    <div class="flex items-center space-x-3 p-3 bg-gray-50 rounded-lg">
                        <div class="text-3xl">${product.image_emoji || 'üì¶'}</div>
                        <div>
                            <div class="font-semibold text-gray-800">${product.name}</div>
                            <div class="text-sm text-gray-600">${product.category} - $${product.price.toFixed(2)}</div>
                        </div>
                        <span class="ml-auto text-xs text-gray-500">${product.stock_quantity > 0 ? product.stock_quantity + ' en stock' : 'Sin stock'}</span>
                    </div>
                `).join('');
                
                const recentActivity = [...orders, ...quotes].sort((a, b) => new Date(b.created_at) - new Date(a.created_at)).slice(0, 3);
                document.getElementById('recent-activity').innerHTML = recentActivity.map(activity => {
                    if (activity.total) { // Es una orden
                        return `
                            <div class="flex items-center space-x-3 p-3 bg-gray-50 rounded-lg">
                                <div class="text-3xl">üõí</div>
                                <div>
                                    <div class="font-semibold text-gray-800">Nueva Orden de Stock</div>
                                    <div class="text-sm text-gray-600">Cliente: ${activity.customer_name} | Total: $${activity.total.toFixed(2)}</div>
                                </div>
                                <span class="ml-auto text-xs text-gray-500">${new Date(activity.created_at).toLocaleDateString()}</span>
                            </div>
                        `;
                    } else { // Es una cotizaci√≥n
                        return `
                            <div class="flex items-center space-x-3 p-3 bg-gray-50 rounded-lg">
                                <div class="text-3xl">üìã</div>
                                <div>
                                    <div class="font-semibold text-gray-800">Nueva Solicitud de Cotizaci√≥n</div>
                                    <div class="text-sm text-gray-600">Cliente: ${activity.customer_name} | Pendiente</div>
                                </div>
                                <span class="ml-auto text-xs text-gray-500">${new Date(activity.created_at).toLocaleDateString()}</span>
                            </div>
                        `;
                    }
                }).join('');
            } catch (error) {
                document.getElementById('recent-products').innerHTML = `<div class="text-center text-red-500">Error al cargar datos.</div>`;
                document.getElementById('recent-activity').innerHTML = `<div class="text-center text-red-500">Error al cargar datos.</div>`;
            }
        }

        // Products
        async function loadProducts() {
            const search = document.getElementById('search-products').value;
            const tableBody = document.getElementById('products-table-body');
            tableBody.innerHTML = `<tr><td colspan="5" class="px-6 py-8 text-center text-gray-500">Cargando productos...</td></tr>`;

            try {
                const products = await apiRequest(`/api/products?search=${encodeURIComponent(search)}`);
                
                tableBody.innerHTML = products.length > 0 ? products.map(product => `
                    <tr class="table-row">
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="flex items-center">
                                <div class="text-2xl mr-4">${product.image_emoji || 'üì¶'}</div>
                                <div>
                                    <div class="text-sm font-medium text-gray-900">${product.name}</div>
                                    <div class="text-sm text-gray-500">ID: ${product.id}</div>
                                </div>
                            </div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">$${product.price.toFixed(2)}</td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${product.in_stock ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">
                                ${product.in_stock ? 'En Stock' : 'Sin Stock'}
                            </span>
                            <div class="text-sm text-gray-500">${product.stock_quantity} unidades</div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${product.category}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                            <button onclick="deleteProduct(${product.id})" class="text-red-600 hover:text-red-900">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
                            </button>
                        </td>
                    </tr>
                `).join('') : `<tr><td colspan="5" class="px-6 py-8 text-center text-gray-500">No se encontraron productos.</td></tr>`;
            } catch (error) {
                tableBody.innerHTML = `<tr><td colspan="5" class="px-6 py-8 text-center text-red-500">Error al cargar productos: ${error.message}</td></tr>`;
            }
        }
        
        document.getElementById('product-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const form = e.target;
            const data = {
                name: form.name.value,
                price: parseFloat(form.price.value),
                category: form.category.value,
                image_emoji: form.image_emoji.value || 'üì¶',
                stock_quantity: parseInt(form.stock_quantity.value) || 0,
                in_stock: form.in_stock.checked,
                is_offer: form.is_offer.checked,
                is_new: form.is_new.checked,
                description: form.description.value
            };
            
            try {
                await apiRequest('/api/products', {
                    method: 'POST',
                    body: JSON.stringify(data)
                });
                showMessage('Producto agregado correctamente!');
                form.reset();
                loadProducts();
            } catch (error) {
                showMessage(`Error al agregar producto: ${error.message}`, true);
            }
        });

        async function deleteProduct(id) {
            if (!confirm('¬øEst√°s seguro de que quieres eliminar este producto?')) return;
            try {
                await apiRequest(`/api/products/${id}`, { method: 'DELETE' });
                showMessage('Producto eliminado correctamente!');
                loadProducts();
            } catch (error) {
                showMessage(`Error al eliminar producto: ${error.message}`, true);
            }
        }
        
        // Orders and Quotes
        async function loadOrdersAndQuotes() {
            const ordersTableBody = document.getElementById('orders-table-body');
            const quotesTableBody = document.getElementById('quotes-table-body');
            ordersTableBody.innerHTML = `<tr><td colspan="5" class="px-6 py-8 text-center text-gray-500">Cargando √≥rdenes...</td></tr>`;
            quotesTableBody.innerHTML = `<tr><td colspan="5" class="px-6 py-8 text-center text-gray-500">Cargando cotizaciones...</td></tr>`;

            try {
                const orders = await apiRequest('/api/stock-orders');
                const quotes = await apiRequest('/api/quotes');

                ordersTableBody.innerHTML = orders.length > 0 ? orders.map(order => `
                    <tr class="table-row">
                        <td class="px-6 py-4 text-sm font-medium text-gray-900">${order.id}</td>
                        <td class="px-6 py-4 text-sm text-gray-500">${order.customer_name}</td>
                        <td class="px-6 py-4 text-sm text-gray-500">$${order.total.toFixed(2)}</td>
                        <td class="px-6 py-4 text-sm text-gray-500">
                            <span class="status-badge bg-green-100 text-green-800">${order.status || 'Completado'}</span>
                        </td>
                        <td class="px-6 py-4 text-sm text-gray-500">${new Date(order.created_at).toLocaleDateString()}</td>
                    </tr>
                `).join('') : `<tr><td colspan="5" class="px-6 py-8 text-center text-gray-500">No hay √≥rdenes de stock.</td></tr>`;

                quotesTableBody.innerHTML = quotes.length > 0 ? quotes.map(quote => `
                    <tr class="table-row">
                        <td class="px-6 py-4 text-sm font-medium text-gray-900">${quote.id}</td>
                        <td class="px-6 py-4 text-sm text-gray-500">${quote.customer_name}</td>
                        <td class="px-6 py-4 text-sm text-gray-500">${quote.customer_email}</td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <select onchange="updateQuoteStatus(${quote.id}, this.value)" class="status-badge bg-yellow-100 text-yellow-800 border-0 outline-none">
                                <option value="pending" ${quote.status === 'pending' ? 'selected' : ''}>Pendiente</option>
                                <option value="reviewed" ${quote.status === 'reviewed' ? 'selected' : ''}>Revisada</option>
                                <option value="quoted" ${quote.status === 'quoted' ? 'selected' : ''}>Cotizada</option>
                                <option value="accepted" ${quote.status === 'accepted' ? 'selected' : ''}>Aceptada</option>
                                <option value="rejected" ${quote.status === 'rejected' ? 'selected' : ''}>Rechazada</option>
                            </select>
                        </td>
                        <td class="px-6 py-4 text-sm text-gray-500">${new Date(quote.created_at).toLocaleDateString()}</td>
                    </tr>
                `).join('') : `<tr><td colspan="5" class="px-6 py-8 text-center text-gray-500">No hay cotizaciones.</td></tr>`;

            } catch (error) {
                ordersTableBody.innerHTML = `<tr><td colspan="5" class="px-6 py-8 text-center text-red-500">Error al cargar √≥rdenes: ${error.message}</td></tr>`;
                quotesTableBody.innerHTML = `<tr><td colspan="5" class="px-6 py-8 text-center text-red-500">Error al cargar cotizaciones: ${error.message}</td></tr>`;
            }
        }
        
        async function updateQuoteStatus(id, newStatus) {
            try {
                await apiRequest(`/api/quotes/${id}/status`, {
                    method: 'PUT',
                    body: JSON.stringify({ status: newStatus })
                });
                showMessage('Estado de cotizaci√≥n actualizado!');
            } catch (error) {
                showMessage(`Error al actualizar estado: ${error.message}`, true);
            }
        }
        
        // Mobile Menu
        const mobileMenuBtn = document.getElementById('mobile-menu-btn');
        const sidebar = document.getElementById('sidebar');
        const overlay = document.getElementById('mobile-overlay');
        
        mobileMenuBtn.addEventListener('click', () => {
            sidebar.classList.toggle('active');
            overlay.classList.toggle('hidden');
        });
        
        overlay.addEventListener('click', () => {
            sidebar.classList.remove('active');
            overlay.classList.add('hidden');
        });
        
        // Initial load
        document.addEventListener('DOMContentLoaded', () => {
            testConnection();
            showSection('dashboard');
        });
        </script>